'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.validChildren = undefined;

var _mjmlCore = require('mjml-core');

var _filter = require('lodash/filter');

var _filter2 = _interopRequireDefault(_filter);

var _includes = require('lodash/includes');

var _includes2 = _interopRequireDefault(_includes);

var _ruleError = require('./ruleError');

var _ruleError2 = _interopRequireDefault(_ruleError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var validChildren = exports.validChildren = function validChildren(element) {
  var children = element.children,
      tagName = element.tagName;

  var Component = _mjmlCore.elements[tagName];

  if (!Component) {
    return;
  }

  if (!children || children.length == 0) {
    return;
  }

  return (0, _filter2.default)(children.map(function (child) {
    var childTagName = child.tagName;
    var ChildComponent = _mjmlCore.elements[childTagName];

    if (!ChildComponent) {
      return null;
    }

    if ((0, _includes2.default)(ChildComponent.parentTag, tagName)) {
      return null;
    }

    return (0, _ruleError2.default)(ChildComponent.tagName + ' cannot be used inside ' + tagName + ', only inside: ' + ChildComponent.parentTag.join(', '), child);
  }));
};